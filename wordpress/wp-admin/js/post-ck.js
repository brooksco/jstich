/* global postL10n, ajaxurl, wpAjax, setPostThumbnailL10n, postboxes, pagenow, tinymce, alert, deleteUserSetting *//* global theList:true, theExtraList:true, getUserSetting, setUserSetting */function array_unique_noempty(e){var t=[];jQuery.each(e,function(e,n){n=jQuery.trim(n);n&&jQuery.inArray(n,t)==-1&&t.push(n)});return t}var tagBox,commentsBox,WPSetThumbnailHTML,WPSetThumbnailID,WPRemoveThumbnail,wptitlehint,makeSlugeditClickable,editPermalink;makeSlugeditClickable=editPermalink=function(){};window.wp=window.wp||{};(function(e){var t=!1;tagBox={clean:function(e){var t=postL10n.comma;","!==t&&(e=e.replace(new RegExp(t,"g"),","));e=e.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"");","!==t&&(e=e.replace(/,/g,t));return e},parseTags:function(t){var n=t.id,r=n.split("-check-num-")[1],i=e(t).closest(".tagsdiv"),s=i.find(".the-tags"),o=postL10n.comma,u=s.val().split(o),a=[];delete u[r];e.each(u,function(t,n){n=e.trim(n);n&&a.push(n)});s.val(this.clean(a.join(o)));this.quickClicks(i);return!1},quickClicks:function(t){var n=e(".the-tags",t),r=e(".tagchecklist",t),i=e(t).attr("id"),s,o;if(!n.length)return;o=n.prop("disabled");s=n.val().split(postL10n.comma);r.empty();e.each(s,function(t,n){var s,u;n=e.trim(n);if(!n)return;s=e("<span />").text(n);if(!o){u=e('<a id="'+i+"-check-num-"+t+'" class="ntdelbutton">X</a>');u.click(function(){tagBox.parseTags(this)});s.prepend("&nbsp;").prepend(u)}r.append(s)})},flushTags:function(t,n,r){var i,s,o,u=e(".the-tags",t),a=e("input.newtag",t),f=postL10n.comma;n=n||!1;o=n?e(n).text():a.val();i=u.val();s=i?i+f+o:o;s=this.clean(s);s=array_unique_noempty(s.split(f)).join(f);u.val(s);this.quickClicks(t);n||a.val("");"undefined"==typeof r&&a.focus();return!1},get:function(t){var n=t.substr(t.indexOf("-")+1);e.post(ajaxurl,{action:"get-tagcloud",tax:n},function(r,i){if(0===r||"success"!=i)r=wpAjax.broken;r=e('<p id="tagcloud-'+n+'" class="the-tagcloud">'+r+"</p>");e("a",r).click(function(){tagBox.flushTags(e(this).closest(".inside").children(".tagsdiv"),this);return!1});e("#"+t).after(r)})},init:function(){var t=this,n=e("div.ajaxtag");e(".tagsdiv").each(function(){tagBox.quickClicks(this)});e("input.tagadd",n).click(function(){t.flushTags(e(this).closest(".tagsdiv"))});e("div.taghint",n).click(function(){e(this).css("visibility","hidden").parent().siblings(".newtag").focus()});e("input.newtag",n).blur(function(){""===this.value&&e(this).parent().siblings(".taghint").css("visibility","")}).focus(function(){e(this).parent().siblings(".taghint").css("visibility","hidden")}).keyup(function(t){if(13==t.which){tagBox.flushTags(e(this).closest(".tagsdiv"));return!1}}).keypress(function(e){if(13==e.which){e.preventDefault();return!1}}).each(function(){var t=e(this).closest("div.tagsdiv").attr("id");e(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+t,{delay:500,minchars:2,multiple:!0,multipleSep:postL10n.comma+" "})});e("#post").submit(function(){e("div.tagsdiv").each(function(){tagBox.flushTags(this,!1,1)})});e("a.tagcloud-link").click(function(){tagBox.get(e(this).attr("id"));e(this).unbind().click(function(){e(this).siblings(".the-tagcloud").toggle();return!1});return!1})}};commentsBox={st:0,get:function(t,n){var r=this.st,i;n||(n=20);this.st+=n;this.total=t;e("#commentsdiv .spinner").show();i={action:"get-comments",mode:"single",_ajax_nonce:e("#add_comment_nonce").val(),p:e("#post_ID").val(),start:r,number:n};e.post(ajaxurl,i,function(t){t=wpAjax.parseAjaxResponse(t);e("#commentsdiv .widefat").show();e("#commentsdiv .spinner").hide();if("object"==typeof t&&t.responses[0]){e("#the-comment-list").append(t.responses[0].data);theList=theExtraList=null;e("a[className*=':']").unbind();commentsBox.st>commentsBox.total?e("#show-comments").hide():e("#show-comments").show().children("a").html(postL10n.showcomm);return}if(1==t){e("#show-comments").html(postL10n.endcomm);return}e("#the-comment-list").append('<tr><td colspan="2">'+wpAjax.broken+"</td></tr>")});return!1}};WPSetThumbnailHTML=function(t){e(".inside","#postimagediv").html(t)};WPSetThumbnailID=function(t){var n=e('input[value="_thumbnail_id"]',"#list-table");n.size()>0&&e("#meta\\["+n.attr("id").match(/[0-9]+/)+"\\]\\[value\\]").text(t)};WPRemoveThumbnail=function(t){e.post(ajaxurl,{action:"set-post-thumbnail",post_id:e("#post_ID").val(),thumbnail_id:-1,_ajax_nonce:t,cookie:encodeURIComponent(document.cookie)},function(e){e=="0"?alert(setPostThumbnailL10n.error):WPSetThumbnailHTML(e)})};e(document).on("heartbeat-send.refresh-lock",function(t,n){var r=e("#active_post_lock").val(),i=e("#post_ID").val(),s={};if(!i||!e("#post-lock-dialog").length)return;s.post_id=i;r&&(s.lock=r);n["wp-refresh-post-lock"]=s}).on("heartbeat-tick.refresh-lock",function(t,n){var r,i,s;if(n["wp-refresh-post-lock"]){r=n["wp-refresh-post-lock"];if(r.lock_error){i=e("#post-lock-dialog");if(i.length&&!i.is(":visible")){if(wp.autosave){e(document).one("heartbeat-tick",function(){wp.autosave.server.suspend();i.removeClass("saving").addClass("saved");e(window).off("beforeunload.edit-post")});i.addClass("saving");wp.autosave.server.triggerSave()}if(r.lock_error.avatar_src){s=e('<img class="avatar avatar-64 photo" width="64" height="64" />').attr("src",r.lock_error.avatar_src.replace(/&amp;/g,"&"));i.find("div.post-locked-avatar").empty().append(s)}i.show().find(".currently-editing").text(r.lock_error.text);i.find(".wp-tab-first").focus()}}else r.new_lock&&e("#active_post_lock").val(r.new_lock)}}).on("before-autosave.update-post-slug",function(){t=document.activeElement&&document.activeElement.id==="title"}).on("after-autosave.update-post-slug",function(){!e("#edit-slug-box > *").length&&!t&&e.post(ajaxurl,{action:"sample-permalink",post_id:e("#post_ID").val(),new_title:e("#title").val(),samplepermalinknonce:e("#samplepermalinknonce").val()},function(t){t!="-1"&&e("#edit-slug-box").html(t)})})})(jQuery);(function(e){function r(){t=!1;window.clearTimeout(n);n=window.setTimeout(function(){t=!0},3e5)}var t,n;e(document).on("heartbeat-send.wp-refresh-nonces",function(n,r){var i,s;t&&(s=e("#post_ID").val())&&(i=e("#_wpnonce").val())&&(r["wp-refresh-post-nonces"]={post_id:s,post_nonce:i})}).on("heartbeat-tick.wp-refresh-nonces",function(t,n){var i=n["wp-refresh-post-nonces"];if(i){r();i.replace&&e.each(i.replace,function(t,n){e("#"+t).val(n)});i.heartbeatNonce&&(window.heartbeatSettings.nonce=i.heartbeatNonce)}}).ready(function(){r()})})(jQuery);jQuery(document).ready(function(e){function g(){var t,n,r=0,i=e("#editable-post-name"),s=i.html(),o=e("#post_name"),u=o.val(),a=e("#edit-slug-buttons"),f=a.html(),l=e("#editable-post-name-full").html();e("#view-post-btn").hide();a.html('<a href="#" class="save button button-small">'+postL10n.ok+'</a> <a class="cancel" href="#">'+postL10n.cancel+"</a>");a.children(".save").click(function(){var t=i.children("input").val();if(t==e("#editable-post-name-full").text())return e("#edit-slug-buttons .cancel").click();e.post(ajaxurl,{action:"sample-permalink",post_id:c,new_slug:t,new_title:e("#title").val(),samplepermalinknonce:e("#samplepermalinknonce").val()},function(n){var r=e("#edit-slug-box");r.html(n);r.hasClass("hidden")&&r.fadeIn("fast",function(){r.removeClass("hidden")});a.html(f);o.val(t);e("#view-post-btn").show()});return!1});e("#edit-slug-buttons .cancel").click(function(){e("#view-post-btn").show();i.html(s);a.html(f);o.val(u);return!1});for(t=0;t<l.length;++t)"%"==l.charAt(t)&&r++;n=r>l.length/4?"":l;i.html('<input type="text" id="new-post-slug" value="'+n+'" />').children("input").keypress(function(e){var t=e.keyCode||0;if(13==t){a.children(".save").click();return!1}if(27==t){a.children(".cancel").click();return!1}}).keyup(function(){o.val(this.value)}).focus()}var t,n,r,i,s,o="",u=0,a=e("#content"),f=e(document),l=e("#edit-slug-box"),c=e("#post_ID").val()||0,h=e("#submitpost"),p=!0,d=e("#post-visibility-select"),v=e("#timestampdiv"),m=e("#post-status-select");postboxes.add_postbox_toggles(pagenow);window.name="";e("#post-lock-dialog .notification-dialog").on("keydown",function(t){if(t.which!=9)return;var n=e(t.target);if(n.hasClass("wp-tab-first")&&t.shiftKey){e(this).find(".wp-tab-last").focus();t.preventDefault()}else if(n.hasClass("wp-tab-last")&&!t.shiftKey){e(this).find(".wp-tab-first").focus();t.preventDefault()}}).filter(":visible").find(".wp-tab-first").focus();wp.heartbeat&&e("#post-lock-dialog").length&&wp.heartbeat.interval(15);r=h.find(":button, :submit, a.submitdelete, #post-preview").on("click.edit-post",function(t){var n=e(this);if(n.hasClass("disabled")){t.preventDefault();return}if(n.hasClass("submitdelete")||n.is("#post-preview"))return;e("form#post").off("submit.edit-post").on("submit.edit-post",function(t){if(t.isDefaultPrevented())return;wp.autosave&&wp.autosave.server.suspend();p=!1;e(window).off("beforeunload.edit-post");r.addClass("disabled");n.attr("id")==="publish"?h.find("#major-publishing-actions .spinner").show():h.find("#minor-publishing .spinner").show()})});e("#post-preview").on("click.post-preview",function(t){var n=e(this),r=e("form#post"),i=e("input#wp-preview"),s=n.attr("target")||"wp-preview",o=navigator.userAgent.toLowerCase();t.preventDefault();if(n.hasClass("disabled"))return;wp.autosave&&wp.autosave.server.tempBlockSave();i.val("dopreview");r.attr("target",s).submit().attr("target","");o.indexOf("safari")!==-1&&o.indexOf("chrome")===-1&&r.attr("action",function(e,t){return t+"?t="+(new Date).getTime()});i.val("")});e("#title").on("keydown.editor-focus",function(t){var n,r;if(t.keyCode===9&&!t.ctrlKey&&!t.altKey&&!t.shiftKey){n=typeof tinymce!="undefined"&&tinymce.get("content");r=e("#content");if(n&&!n.isHidden())n.focus();else{if(!r.length)return;r.focus()}t.preventDefault()}});e("#auto_draft").val()&&e("#title").blur(function(){var t;if(!this.value||e("#edit-slug-box > *").length)return;e("form#post").one("submit",function(){t=!0});window.setTimeout(function(){!t&&wp.autosave&&wp.autosave.server.triggerSave()},200)});f.on("autosave-disable-buttons.edit-post",function(){r.addClass("disabled")}).on("autosave-enable-buttons.edit-post",function(){(!wp.heartbeat||!wp.heartbeat.hasConnectionError())&&r.removeClass("disabled")}).on("before-autosave.edit-post",function(){e(".autosave-message").text(postL10n.savingText)}).on("after-autosave.edit-post",function(t,n){e(".autosave-message").text(n.message)});e(window).on("beforeunload.edit-post",function(){var e=typeof tinymce!="undefined"&&tinymce.get("content");if(e&&!e.isHidden()&&e.isDirty()||wp.autosave&&wp.autosave.server.postChanged())return postL10n.saveAlert}).on("unload.edit-post",function(t){if(!p)return;if(t.target&&t.target.nodeName!="#document")return;e.ajax({type:"POST",url:ajaxurl,async:!1,data:{action:"wp-remove-post-lock",_wpnonce:e("#_wpnonce").val(),post_ID:e("#post_ID").val(),active_post_lock:e("#active_post_lock").val()}})});e("#tagsdiv-post_tag").length?tagBox.init():e("#side-sortables, #normal-sortables, #advanced-sortables").children("div.postbox").each(function(){if(this.id.indexOf("tagsdiv-")===0){tagBox.init();return!1}});e(".categorydiv").each(function(){var t=e(this).attr("id"),n,r,i,s,o;i=t.split("-");i.shift();s=i.join("-");o=s+"_tab";s=="category"&&(o="cats");e("a","#"+s+"-tabs").click(function(){var t=e(this).attr("href");e(this).parent().addClass("tabs").siblings("li").removeClass("tabs");e("#"+s+"-tabs").siblings(".tabs-panel").hide();e(t).show();"#"+s+"-all"==t?deleteUserSetting(o):setUserSetting(o,"pop");return!1});getUserSetting(o)&&e('a[href="#'+s+'-pop"]',"#"+s+"-tabs").click();e("#new"+s).one("focus",function(){e(this).val("").removeClass("form-input-tip")});e("#new"+s).keypress(function(t){if(13===t.keyCode){t.preventDefault();e("#"+s+"-add-submit").click()}});e("#"+s+"-add-submit").click(function(){e("#new"+s).focus()});n=function(t){if(!e("#new"+s).val())return!1;t.data+="&"+e(":checked","#"+s+"checklist").serialize();e("#"+s+"-add-submit").prop("disabled",!0);return t};r=function(t,n){var r,i=e("#new"+s+"_parent");e("#"+s+"-add-submit").prop("disabled",!1);if("undefined"!=n.parsed.responses[0]&&(r=n.parsed.responses[0].supplemental.newcat_parent)){i.before(r);i.remove()}};e("#"+s+"checklist").wpList({alt:"",response:s+"-ajax-response",addBefore:n,addAfter:r});e("#"+s+"-add-toggle").click(function(){e("#"+s+"-adder").toggleClass("wp-hidden-children");e('a[href="#'+s+'-all"]',"#"+s+"-tabs").click();e("#new"+s).focus();return!1});e("#"+s+"checklist, #"+s+"checklist-pop").on("click",'li.popular-category > label input[type="checkbox"]',function(){var t=e(this),n=t.is(":checked"),r=t.val();r&&t.parents("#taxonomy-"+s).length&&e("#in-"+s+"-"+r+", #in-popular-"+s+"-"+r).prop("checked",n)})});e("#postcustom").length&&e("#the-list").wpList({addAfter:function(){e("table#list-table").show()},addBefore:function(t){t.data+="&post_id="+e("#post_ID").val();return t}});if(e("#submitdiv").length){t=e("#timestamp").html();n=e("#post-visibility-display").html();i=function(){if(d.find("input:radio:checked").val()!="public"){e("#sticky").prop("checked",!1);e("#sticky-span").hide()}else e("#sticky-span").show();d.find("input:radio:checked").val()!="password"?e("#password-span").hide():e("#password-span").show()};s=function(){if(!v.length)return!0;var n,r,i,s,o=e("#post_status"),u=e('option[value="publish"]',o),a=e("#aa").val(),f=e("#mm").val(),l=e("#jj").val(),c=e("#hh").val(),h=e("#mn").val();n=new Date(a,f-1,l,c,h);r=new Date(e("#hidden_aa").val(),e("#hidden_mm").val()-1,e("#hidden_jj").val(),e("#hidden_hh").val(),e("#hidden_mn").val());i=new Date(e("#cur_aa").val(),e("#cur_mm").val()-1,e("#cur_jj").val(),e("#cur_hh").val(),e("#cur_mn").val());if(n.getFullYear()!=a||1+n.getMonth()!=f||n.getDate()!=l||n.getMinutes()!=h){v.find(".timestamp-wrap").addClass("form-invalid");return!1}v.find(".timestamp-wrap").removeClass("form-invalid");if(n>i&&e("#original_post_status").val()!="future"){s=postL10n.publishOnFuture;e("#publish").val(postL10n.schedule)}else if(n<=i&&e("#original_post_status").val()!="publish"){s=postL10n.publishOn;e("#publish").val(postL10n.publish)}else{s=postL10n.publishOnPast;e("#publish").val(postL10n.update)}r.toUTCString()==n.toUTCString()?e("#timestamp").html(t):e("#timestamp").html(s+" <b>"+postL10n.dateFormat.replace("%1$s",e('option[value="'+e("#mm").val()+'"]',"#mm").text()).replace("%2$s",l).replace("%3$s",a).replace("%4$s",c).replace("%5$s",h)+"</b> ");if(d.find("input:radio:checked").val()=="private"){e("#publish").val(postL10n.update);0===u.length?o.append('<option value="publish">'+postL10n.privatelyPublished+"</option>"):u.html(postL10n.privatelyPublished);e('option[value="publish"]',o).prop("selected",!0);e("#misc-publishing-actions .edit-post-status").hide()}else{if(e("#original_post_status").val()=="future"||e("#original_post_status").val()=="draft"){if(u.length){u.remove();o.val(e("#hidden_post_status").val())}}else u.html(postL10n.published);o.is(":hidden")&&e("#misc-publishing-actions .edit-post-status").show()}e("#post-status-display").html(e("option:selected",o).text());if(e("option:selected",o).val()=="private"||e("option:selected",o).val()=="publish")e("#save-post").hide();else{e("#save-post").show();e("option:selected",o).val()=="pending"?e("#save-post").show().val(postL10n.savePending):e("#save-post").show().val(postL10n.saveDraft)}return!0};e("#visibility .edit-visibility").click(function(){if(d.is(":hidden")){i();d.slideDown("fast").find('input[type="radio"]').first().focus();e(this).hide()}return!1});d.find(".cancel-post-visibility").click(function(t){d.slideUp("fast");e("#visibility-radio-"+e("#hidden-post-visibility").val()).prop("checked",!0);e("#post_password").val(e("#hidden-post-password").val());e("#sticky").prop("checked",e("#hidden-post-sticky").prop("checked"));e("#post-visibility-display").html(n);e("#visibility .edit-visibility").show().focus();s();t.preventDefault()});d.find(".save-post-visibility").click(function(t){d.slideUp("fast");e("#visibility .edit-visibility").show();s();d.find("input:radio:checked").val()!="public"&&e("#sticky").prop("checked",!1);e("#sticky").prop("checked")?o="Sticky":o="";e("#post-visibility-display").html(postL10n[d.find("input:radio:checked").val()+o]);t.preventDefault()});d.find("input:radio").change(function(){i()});v.siblings("a.edit-timestamp").click(function(t){if(v.is(":hidden")){v.slideDown("fast");e("#mm").focus();e(this).hide()}t.preventDefault()});v.find(".cancel-timestamp").click(function(t){v.slideUp("fast").siblings("a.edit-timestamp").show().focus();e("#mm").val(e("#hidden_mm").val());e("#jj").val(e("#hidden_jj").val());e("#aa").val(e("#hidden_aa").val());e("#hh").val(e("#hidden_hh").val());e("#mn").val(e("#hidden_mn").val());s();t.preventDefault()});v.find(".save-timestamp").click(function(e){if(s()){v.slideUp("fast");v.siblings("a.edit-timestamp").show()}e.preventDefault()});e("#post").on("submit",function(t){if(!s()){t.preventDefault();v.show();wp.autosave&&wp.autosave.enableButtons();e("#publishing-action .spinner").hide()}});m.siblings("a.edit-post-status").click(function(t){if(m.is(":hidden")){m.slideDown("fast").find("select").focus();e(this).hide()}t.preventDefault()});m.find(".save-post-status").click(function(e){m.slideUp("fast").siblings("a.edit-post-status").show();s();e.preventDefault()});m.find(".cancel-post-status").click(function(t){e("#post-status-select").slideUp("fast").siblings("a.edit-post-status").show().focus();e("#post_status").val(e("#hidden_post_status").val());s();t.preventDefault()})}l.length&&l.on("click",function(t){var n=e(t.target);(n.is("#editable-post-name")||n.hasClass("edit-slug"))&&g()});if(typeof wpWordCount!="undefined"){f.triggerHandler("wpcountwords",[a.val()]);a.keyup(function(e){var t=e.keyCode||e.charCode;if(t==u)return!0;(13==t||8==u||46==u)&&f.triggerHandler("wpcountwords",[a.val()]);u=t;return!0})}wptitlehint=function(t){t=t||"title";var n=e("#"+t),r=e("#"+t+"-prompt-text");""===n.val()&&r.removeClass("screen-reader-text");r.click(function(){e(this).addClass("screen-reader-text");n.focus()});n.blur(function(){""===this.value&&r.removeClass("screen-reader-text")}).focus(function(){r.addClass("screen-reader-text")}).keydown(function(t){r.addClass("screen-reader-text");e(this).unbind(t)})};wptitlehint();(function(){function o(e){r?t.theme.resizeTo(null,n+e.pageY):i.height(Math.max(50,n+e.pageY));e.preventDefault()}function u(){var n,s;if(r){t.focus();s=e("#wp-content-editor-container .mce-toolbar-grp").height();if(s<10||s>200)s=30;n=parseInt(e("#content_ifr").css("height"),10)+s-28}else{i.focus();n=parseInt(i.css("height"),10)}f.off(".wp-editor-resize");n&&n>50&&n<5e3&&setUserSetting("ed_size",n)}var t,n,r,i=e("textarea#content"),s=e("#post-status-info");if(!i.length||"ontouchstart"in window)return;i.css("resize","none");s.on("mousedown.wp-editor-resize",function(s){typeof tinymce!="undefined"&&(t=tinymce.get("content"));if(t&&!t.isHidden()){r=!0;n=e("#content_ifr").height()-s.pageY}else{r=!1;n=i.height()-s.pageY;i.blur()}f.on("mousemove.wp-editor-resize",o).on("mouseup.wp-editor-resize mouseleave.wp-editor-resize",u);s.preventDefault()}).on("mouseup.wp-editor-resize",u)})();typeof tinymce!="undefined"&&e("#post-formats-select input.post-format").on("change.set-editor-class",function(){var t,n,r=this.id;if(r&&e(this).prop("checked")){t=tinymce.get("content");if(t){n=t.getBody();n.className=n.className.replace(/\bpost-format-[^ ]+/,"");t.dom.addClass(n,r=="post-format-0"?"post-format-standard":r)}}})});
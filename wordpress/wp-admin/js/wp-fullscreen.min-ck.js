!function(e,t){function n(){h.removeClass("wp-dfw-show-ui")}function r(t){o.$dfwWrap.parents().each(function(n,r){var i,s=e(r);return t?(r.style.position&&s.data("wp-dfw-css-position",r.style.position),s.css("position","static")):(i=s.data("wp-dfw-css-position"),i=i||"",s.css("position",i)),"BODY"===r.nodeName?!1:void 0})}var i,s,o,u,a,f,l=0,c="transitionend webkitTransitionEnd",h=e(document.body),p=e(document);f=function(){this.topics={},this.subscribe=function(e,t){return this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t),t},this.unsubscribe=function(e,t){var n,r,i=this.topics[e];if(!i)return t||[];if(t){for(n=0,r=i.length;r>n;n++)t==i[n]&&i.splice(n,1);return t}return this.topics[e]=[],i},this.publish=function(e,t){var n,r,i,s=this.topics[e];if(s){for(t=t||[],n=0,r=s.length;r>n;n++)i=s[n].apply(null,t)===!1||i;return!i}}},i={},s=i.pubsub=new f,o=i.settings={visible:!1,mode:"tinymce",id:"",title_id:"",timer:0,toolbar_shown:!1},u=i.toggleUI=function(e){clearTimeout(a),h.hasClass("wp-dfw-show-ui")&&"show"!==e?"autohide"!==e&&h.removeClass("wp-dfw-show-ui"):h.addClass("wp-dfw-show-ui"),"autohide"===e&&(a=setTimeout(n,2e3))},i.on=function(){var n,r,s;if(!o.visible){if(o.$fullscreenFader||i.ui.init(),"object"==typeof t.wp_fullscreen_settings&&e.extend(o,t.wp_fullscreen_settings),n=o.id||t.wpActiveEditor,!n){if(!o.hasTinymce)return;n=tinymce.activeEditor.id}o.id=n,r=o.$dfwWrap=e("#wp-"+n+"-wrap"),r.length&&(o.$dfwTextarea=e("#"+n),o.$editorContainer=r.find(".wp-editor-container"),l=p.scrollTop(),o.hasTinymce&&(o.editor=tinymce.get(n)),o.editor&&!o.editor.isHidden()?(o.origHeight=e("#"+n+"_ifr").height(),o.mode="tinymce"):(o.origHeight=o.$dfwTextarea.height(),o.mode="html"),s="undefined"==typeof t.adminpage||"post-php"!==t.adminpage&&"post-new-php"!==t.adminpage?n+"-title":"title",o.$dfwTitle=e("#"+s),o.$dfwTitle.length||(o.$dfwTitle=null),i.ui.fade("show","showing","shown"))}},i.off=function(){o.visible&&i.ui.fade("hide","hiding","hidden")},i.switchmode=function(e){var t=o.mode;return e&&o.visible&&o.hasTinymce&&"undefined"!=typeof switchEditors?t==e?t:("tinymce"!==e||o.editor||(o.editor=tinymce.get(o.id),!o.editor&&"undefined"!=typeof tinyMCEPreInit&&tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit[o.id]&&(tinyMCEPreInit.mceInit[o.id].wp_fullscreen=!0)),o.mode=e,switchEditors.go(o.id,e),i.refreshButtons(!0),"html"===e&&setTimeout(i.resizeTextarea,200),e):t},i.save=function(){var n=e("#hiddenaction"),r=n.val(),i=e("#wp-fullscreen-save .spinner"),s=e("#wp-fullscreen-save .wp-fullscreen-saved-message"),u=e("#wp-fullscreen-save .wp-fullscreen-error-message");i.show(),u.hide(),s.hide(),n.val("wp-fullscreen-save-post"),o.editor&&!o.editor.isHidden()&&o.editor.save(),e.ajax({url:t.ajaxurl,type:"post",data:e("form#post").serialize(),dataType:"json"}).done(function(t){i.hide(),t&&t.success?(s.show(),setTimeout(function(){s.fadeOut(300)},3e3),t.data&&t.data.last_edited&&e("#wp-fullscreen-save input").attr("title",t.data.last_edited)):u.show()}).fail(function(){i.hide(),u.show()}),n.val(r)},i.dfwWidth=function(t,n){var r;return t&&-1!==t.toString().indexOf("%")?(o.$editorContainer.css("width",t),o.$statusbar.css("width",t),void (o.$dfwTitle&&o.$dfwTitle.css("width",t))):t?(n?r=t:(r=o.$editorContainer.width(),r+=t),void (200>r||r>1200||(o.$editorContainer.width(r),o.$statusbar.width(r),o.$dfwTitle&&o.$dfwTitle.width(r-16),setUserSetting("dfw_width",r)))):(r=e("#wp-fullscreen-body").data("theme-width")||800,o.$editorContainer.width(r),o.$statusbar.width(r),o.$dfwTitle&&o.$dfwTitle.width(r-16),void deleteUserSetting("dfw_width"))},s.subscribe("show",function(){var t=e("#last-edit").text();t&&e("#wp-fullscreen-save input").attr("title",t)}),s.subscribe("showing",function(){h.addClass("wp-fullscreen-active"),o.$dfwWrap.addClass("wp-fullscreen-wrap"),o.$dfwTitle&&(o.$dfwTitle.after('<span id="wp-fullscreen-title-placeholder">'),o.$dfwWrap.prepend(o.$dfwTitle.addClass("wp-fullscreen-title"))),i.refreshButtons(),r(!0),e("#wpadminbar").hide(),u("autohide"),i.bind_resize(),o.editor&&o.editor.execCommand("wpFullScreenOn"),"ontouchstart"in t?i.dfwWidth("90%"):i.dfwWidth(e("#wp-fullscreen-body").data("dfw-width")||800,!0),scrollTo(0,0)}),s.subscribe("shown",function(){o.visible=!0,o.editor&&!o.editor.isHidden()?o.editor.execCommand("wpAutoResize"):i.resizeTextarea("force")}),s.subscribe("hide",function(){p.unbind(".fullscreen"),o.$dfwTextarea.unbind(".wp-dfw-resize")}),s.subscribe("hiding",function(){h.removeClass("wp-fullscreen-active"),o.$dfwTitle&&e("#wp-fullscreen-title-placeholder").before(o.$dfwTitle.removeClass("wp-fullscreen-title").css("width","")).remove(),o.$dfwWrap.removeClass("wp-fullscreen-wrap"),o.$editorContainer.css("width",""),o.$dfwTextarea.add("#"+o.id+"_ifr").height(o.origHeight),o.editor&&o.editor.execCommand("wpFullScreenOff"),r(!1),t.scrollTo(0,l),e("#wpadminbar").show()}),s.subscribe("hidden",function(){o.visible=!1}),i.refreshButtons=function(t){"html"===o.mode?(e("#wp-fullscreen-mode-bar").removeClass("wp-tmce-mode").addClass("wp-html-mode").find("a").removeClass("active").filter(".wp-fullscreen-mode-html").addClass("active"),t?e("#wp-fullscreen-button-bar").fadeOut(150,function(){e(this).addClass("wp-html-mode").fadeIn(150)}):e("#wp-fullscreen-button-bar").addClass("wp-html-mode")):"tinymce"===o.mode&&(e("#wp-fullscreen-mode-bar").removeClass("wp-html-mode").addClass("wp-tmce-mode").find("a").removeClass("active").filter(".wp-fullscreen-mode-tinymce").addClass("active"),t?e("#wp-fullscreen-button-bar").fadeOut(150,function(){e(this).removeClass("wp-html-mode").fadeIn(150)}):e("#wp-fullscreen-button-bar").removeClass("wp-html-mode"))},i.ui={init:function(){var n;o.toolbar=n=e("#fullscreen-topbar"),o.$fullscreenFader=e("#fullscreen-fader"),o.$statusbar=e("#wp-fullscreen-status"),o.hasTinymce="undefined"!=typeof tinymce,o.hasTinymce||e("#wp-fullscreen-mode-bar").hide(),p.keyup(function(e){var t,n=e.keyCode||e.charCode;o.visible&&(t=navigator.platform&&-1!==navigator.platform.indexOf("Mac")?e.ctrlKey:e.altKey,!t||61!==n&&107!==n&&187!==n||(i.dfwWidth(25),e.preventDefault()),!t||45!==n&&109!==n&&189!==n||(i.dfwWidth(-25),e.preventDefault()),t&&48===n&&(i.dfwWidth(0),e.preventDefault()))}),p.on("keydown.wp-fullscreen",function(e){27===e.which&&o.visible&&(i.off(),e.stopImmediatePropagation())}),"ontouchstart"in t&&h.addClass("wp-dfw-touch"),n.on("mouseenter",function(){u("show")}).on("mouseleave",function(){u("autohide")}),e("#wp-fullscreen-buttons").on("click.wp-fullscreen","button",function(e){var n=e.currentTarget.id?e.currentTarget.id.substr(6):null;if(o.editor&&"tinymce"===o.mode)switch(n){case"bold":o.editor.execCommand("Bold");break;case"italic":o.editor.execCommand("Italic");break;case"bullist":o.editor.execCommand("InsertUnorderedList");break;case"numlist":o.editor.execCommand("InsertOrderedList");break;case"link":o.editor.execCommand("WP_Link");break;case"unlink":o.editor.execCommand("unlink");break;case"help":o.editor.execCommand("WP_Help");break;case"blockquote":o.editor.execCommand("mceBlockQuote")}else"link"===n&&t.wpLink&&t.wpLink.open();"wp-media-library"===n&&"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(o.id)})},fade:function(e,t,n){o.$fullscreenFader||i.ui.init(),(!e||s.publish(e))&&i.fade.In(o.$fullscreenFader,200,function(){t&&s.publish(t),i.fade.Out(o.$fullscreenFader,200,function(){n&&s.publish(n)})})}},i.fade={sensitivity:100,In:function(t,n,r,s){if(r=r||e.noop,n=n||400,s=s||!1,i.fade.transitions){if(t.is(":visible"))return t.addClass("fade-trigger"),t;t.show(),t.first().one(c,function(){r()}),setTimeout(function(){t.addClass("fade-trigger")},this.sensitivity)}else s&&t.stop(),t.css("opacity",1),t.first().fadeIn(n,r),t.length>1&&t.not(":first").fadeIn(n);return t},Out:function(t,n,r,s){return r=r||e.noop,n=n||400,s=s||!1,t.is(":visible")?(i.fade.transitions?(t.first().one(c,function(){t.hasClass("fade-trigger")||(t.hide(),r())}),setTimeout(function(){t.removeClass("fade-trigger")},this.sensitivity)):(s&&t.stop(),t.first().fadeOut(n,r),t.length>1&&t.not(":first").fadeOut(n)),t):t},transitions:function(){var e=document.documentElement.style;return"string"==typeof e.WebkitTransition||"string"==typeof e.MozTransition||"string"==typeof e.OTransition||"string"==typeof e.transition}()},i.bind_resize=function(){o.$dfwTextarea.on("keydown.wp-dfw-resize click.wp-dfw-resize paste.wp-dfw-resize",function(){i.resizeTextarea()})},i.resizeTextarea=function(){var e=o.$dfwTextarea[0];e.scrollHeight>e.clientHeight&&(e.style.height=e.scrollHeight+50+"px")},t.wp=t.wp||{},t.wp.editor=t.wp.editor||{},t.wp.editor.fullscreen=i}(jQuery,window);
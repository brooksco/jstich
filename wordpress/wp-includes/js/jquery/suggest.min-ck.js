!function(e){e.suggest=function(t,n){function r(){var e=v.offset();m.css({top:e.top+t.offsetHeight+"px",left:e.left+"px"})}function i(e){if(/27$|38$|40$/.test(e.keyCode)&&m.is(":visible")||/^13$|^9$/.test(e.keyCode)&&c())switch(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,e.keyCode){case 38:d();break;case 40:p();break;case 9:case 13:h();break;case 27:m.hide()}else v.val().length!=y&&(g&&clearTimeout(g),g=setTimeout(s,n.delay),y=v.val().length)}function s(){var t,r,i=e.trim(v.val());n.multiple&&(t=i.lastIndexOf(n.multipleSep),-1!=t&&(i=e.trim(i.substr(t+n.multipleSep.length)))),i.length>=n.minchars?(cached=o(i),cached?f(cached.items):e.get(n.source,{q:i},function(e){m.hide(),r=l(e,i),f(r),u(i,r,e.length)})):m.hide()}function o(e){var t;for(t=0;t<b.length;t++)if(b[t].q==e)return b.unshift(b.splice(t,1)[0]),b[0];return!1}function u(e,t,r){for(var i;b.length&&w+r>n.maxCacheSize;)i=b.pop(),w-=i.size;b.push({q:e,size:r,items:t}),w+=r}function f(t){var i,s="";if(t){if(!t.length)return void m.hide();for(r(),i=0;i<t.length;i++)s+="<li>"+t[i]+"</li>";m.html(s).show(),m.children("li").mouseover(function(){m.children("li").removeClass(n.selectClass),e(this).addClass(n.selectClass)}).click(function(e){e.preventDefault(),e.stopPropagation(),h()})}}function l(t,r){var i,s,o=[],u=t.split(n.delimiter);for(i=0;i<u.length;i++)s=e.trim(u[i]),s&&(s=s.replace(new RegExp(r,"ig"),function(e){return'<span class="'+n.matchClass+'">'+e+"</span>"}),o[o.length]=s);return o}function c(){var e;return m.is(":visible")?(e=m.children("li."+n.selectClass),e.length||(e=!1),e):!1}function h(){$currentResult=c(),$currentResult&&(n.multiple?($currentVal=-1!=v.val().indexOf(n.multipleSep)?v.val().substr(0,v.val().lastIndexOf(n.multipleSep)+n.multipleSep.length):"",v.val($currentVal+$currentResult.text()+n.multipleSep),v.focus()):v.val($currentResult.text()),m.hide(),v.trigger("change"),n.onSelect&&n.onSelect.apply(v[0]))}function p(){$currentResult=c(),$currentResult?$currentResult.removeClass(n.selectClass).next().addClass(n.selectClass):m.children("li:first-child").addClass(n.selectClass)}function d(){var e=c();e?e.removeClass(n.selectClass).prev().addClass(n.selectClass):m.children("li:last-child").addClass(n.selectClass)}var v,m,g,y,b,w;v=e(t).attr("autocomplete","off"),m=e("<ul/>"),g=!1,y=0,b=[],w=0,m.addClass(n.resultsClass).appendTo("body"),r(),e(window).load(r).resize(r),v.blur(function(){setTimeout(function(){m.hide()},200)}),v.keydown(i)},e.fn.suggest=function(t,n){return t?(n=n||{},n.multiple=n.multiple||!1,n.multipleSep=n.multipleSep||", ",n.source=t,n.delay=n.delay||100,n.resultsClass=n.resultsClass||"ac_results",n.selectClass=n.selectClass||"ac_over",n.matchClass=n.matchClass||"ac_match",n.minchars=n.minchars||2,n.delimiter=n.delimiter||"\n",n.onSelect=n.onSelect||!1,n.maxCacheSize=n.maxCacheSize||65536,this.each(function(){new e.suggest(this,n)}),this):void 0}}(jQuery);
!function(){var e=tinymce.DOM;tinymce.create("tinymce.plugins.WordPress",{init:function(t,n){var r,i,s,o,u,f=this,l=t.getParam("wordpress_adv_toolbar","toolbar2"),c=0;r='<img src="'+n+'/img/trans.gif" class="mce-wp-more mceItemNoResize" title="'+t.getLang("wordpress.wp_more_alt")+'" />',i='<img src="'+n+'/img/trans.gif" class="mce-wp-nextpage mceItemNoResize" title="'+t.getLang("wordpress.wp_page_alt")+'" />',"1"==getUserSetting("hidetb","0")&&(t.settings.wordpress_adv_hidden=0),t.onPostRender.add(function(){var n=t.controlManager.get(l);t.getParam("wordpress_adv_hidden",1)&&n&&(e.hide(n.id),f._resizeIframe(t,l,28))}),t.addCommand("WP_More",function(){t.execCommand("mceInsertContent",0,r)}),t.addCommand("WP_Page",function(){t.execCommand("mceInsertContent",0,i)}),t.addCommand("WP_Help",function(){t.windowManager.open({url:tinymce.baseURL+"/wp-mce-help.php",width:450,height:420,inline:1})}),t.addCommand("WP_Adv",function(){var n=t.controlManager,r=n.get(l).id;"undefined"!=r&&(e.isHidden(r)?(n.setActive("wp_adv",1),e.show(r),f._resizeIframe(t,l,-28),t.settings.wordpress_adv_hidden=0,setUserSetting("hidetb","1")):(n.setActive("wp_adv",0),e.hide(r),f._resizeIframe(t,l,28),t.settings.wordpress_adv_hidden=1,setUserSetting("hidetb","0")))}),t.addCommand("WP_Medialib",function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(t.id)}),t.addButton("wp_more",{title:"wordpress.wp_more_desc",cmd:"WP_More"}),t.addButton("wp_page",{title:"wordpress.wp_page_desc",image:n+"/img/page.gif",cmd:"WP_Page"}),t.addButton("wp_help",{title:"wordpress.wp_help_desc",cmd:"WP_Help"}),t.addButton("wp_adv",{title:"wordpress.wp_adv_desc",cmd:"WP_Adv"}),t.addButton("add_media",{title:"wordpress.add_media",image:n+"/img/image.gif",cmd:"WP_Medialib"}),t.onBeforeExecCommand.add(function(e,t,n,r,i){var s,o,a,f,l,c,p=tinymce.DOM;"mceFullScreen"==t&&"mce_fullscreen"!=e.id&&p.select("a.thickbox").length&&(e.settings.theme_advanced_buttons1+=",|,add_media"),("JustifyLeft"==t||"JustifyRight"==t||"JustifyCenter"==t)&&(s=e.selection.getNode(),"IMG"==s.nodeName&&(c=t.substr(7).toLowerCase(),l="align"+c,o=e.dom.getParent(s,"dl.wp-caption"),a=e.dom.getParent(s,"div.mceTemp"),o&&a?(f=e.dom.hasClass(o,l)?"alignnone":l,o.className=o.className.replace(/align[^ '"]+\s?/g,""),e.dom.addClass(o,f),"aligncenter"==f?e.dom.addClass(a,"mceIEcenter"):e.dom.removeClass(a,"mceIEcenter"),i.terminate=!0,e.execCommand("mceRepaint")):e.dom.hasClass(s,l)?e.dom.addClass(s,"alignnone"):e.dom.removeClass(s,"alignnone"))),!tinymce.isWebKit||"InsertUnorderedList"!=t&&"InsertOrderedList"!=t||(u||(u=e.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}")),e.getDoc().head.appendChild(u))}),t.onExecCommand.add(function(e,t){tinymce.isWebKit&&u&&("InsertUnorderedList"==t||"InsertOrderedList"==t)&&e.dom.remove(u)}),t.onInit.add(function(e){var t=e.getParam("body_class",""),n=e.getBody();t=t?t.split(" "):[],"rtl"==e.getParam("directionality","")&&t.push("rtl"),tinymce.isIE9?t.push("ie9"):tinymce.isIE8?t.push("ie8"):tinymce.isIE7&&t.push("ie7"),"wp_mce_fullscreen"!=e.id&&"mce_fullscreen"!=e.id?t.push("wp-editor"):"mce_fullscreen"==e.id&&t.push("mce-fullscreen"),tinymce.each(t,function(t){t&&e.dom.addClass(n,t)}),e.onNodeChange.add(function(e,t,n){var r;"IMG"==n.nodeName?r=e.dom.getParent(n,"dl.wp-caption"):"DIV"==n.nodeName&&e.dom.hasClass(n,"mceTemp")&&(r=n.firstChild,e.dom.hasClass(r,"wp-caption")||(r=!1)),r&&(e.dom.hasClass(r,"alignleft")?t.setActive("justifyleft",1):e.dom.hasClass(r,"alignright")?t.setActive("justifyright",1):e.dom.hasClass(r,"aligncenter")&&t.setActive("justifycenter",1))}),e.onBeforeSetContent.add(function(e,t){t.content&&(t.content=t.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)( [^>]*)?>/gi,"<$1$2>"),t.content=t.content.replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)>\s*<\/p>/gi,"</$1>"))})}),"undefined"!=typeof jQuery&&t.onKeyUp.add(function(e,t){var n=t.keyCode||t.charCode;n!=c&&((13==n||8==c||46==c)&&jQuery(document).triggerHandler("wpcountwords",[e.getContent({format:"raw"})]),c=n)}),t.onSaveContent.addToTop(function(e,t){t.content=t.content.replace(/<p>(<br ?\/?>|\u00a0|\uFEFF)?<\/p>/g,"<p>&nbsp;</p>")}),tinymce.isIOS5&&t.onKeyDown.add(function(){document.activeElement==document.body&&t.getWin().focus()}),t.onSaveContent.add(function(e,t){e.isHidden()?t.content=t.element.value:e.getParam("wpautop",!0)&&"object"==typeof switchEditors&&(t.content=switchEditors.pre_wpautop(t.content))}),f._handleMoreBreak(t,n),o="alt+shift",t.addShortcut(o+"+c","justifycenter_desc","JustifyCenter"),t.addShortcut(o+"+r","justifyright_desc","JustifyRight"),t.addShortcut(o+"+l","justifyleft_desc","JustifyLeft"),t.addShortcut(o+"+j","justifyfull_desc","JustifyFull"),t.addShortcut(o+"+q","blockquote_desc","mceBlockQuote"),t.addShortcut(o+"+u","bullist_desc","InsertUnorderedList"),t.addShortcut(o+"+o","numlist_desc","InsertOrderedList"),t.addShortcut(o+"+n","spellchecker.desc","mceSpellCheck"),t.addShortcut(o+"+a","link_desc","WP_Link"),t.addShortcut(o+"+s","unlink_desc","unlink"),t.addShortcut(o+"+m","image_desc","WP_Medialib"),t.addShortcut(o+"+z","wordpress.wp_adv_desc","WP_Adv"),t.addShortcut(o+"+t","wordpress.wp_more_desc","WP_More"),t.addShortcut(o+"+d","striketrough_desc","Strikethrough"),t.addShortcut(o+"+h","help_desc","WP_Help"),t.addShortcut(o+"+p","wordpress.wp_page_desc","WP_Page"),t.addShortcut("ctrl+s","save_desc",function(){"function"==typeof autosave&&autosave()}),/\bwpfullscreen\b/.test(t.settings.plugins)?t.addShortcut(o+"+w","wordpress.wp_fullscreen_desc","wpFullScreen"):/\bfullscreen\b/.test(t.settings.plugins)&&t.addShortcut(o+"+g","fullscreen.desc","mceFullScreen"),t.onInit.add(function(e){tinymce.dom.Event.add(e.getWin(),"scroll",function(){e.plugins.wordpress._hideButtons()}),tinymce.dom.Event.add(e.getBody(),"dragstart",function(){e.plugins.wordpress._hideButtons()})}),t.onBeforeExecCommand.add(function(e){e.plugins.wordpress._hideButtons()}),t.onSaveContent.add(function(e){e.plugins.wordpress._hideButtons()}),t.onMouseDown.add(function(e,t){"IMG"!=t.target.nodeName&&e.plugins.wordpress._hideButtons()}),t.onKeyDown.add(function(e,t){(t.which==tinymce.VK.DELETE||t.which==tinymce.VK.BACKSPACE)&&e.plugins.wordpress._hideButtons()}),s=function(e){var n;if("mceModalBlocker"==e.target.id||"ui-widget-overlay"==e.target.className)for(n in t.windowManager.windows)t.windowManager.close(null,n)},tinymce.dom.Event.remove(document.body,"click",s),tinymce.dom.Event.add(document.body,"click",s)},getInfo:function(){return{longname:"WordPress Plugin",author:"WordPress",authorurl:"http://wordpress.org",infourl:"http://wordpress.org",version:"3.0"}},_setEmbed:function(e){return e.replace(/\[embed\]([\s\S]+?)\[\/embed\][\s\u00a0]*/g,function(e,t){return'<img width="300" height="200" src="'+tinymce.baseURL+'/plugins/wordpress/img/trans.gif" class="wp-oembed mceItemNoResize" alt="'+t+'" title="'+t+'" />'})},_getEmbed:function(e){return e.replace(/<img[^>]+>/g,function(e){if(-1!=e.indexOf('class="wp-oembed')){var t=e.match(/alt="([^\"]+)"/);t[1]&&(e="[embed]"+t[1]+"[/embed]")}return e})},_showButtons:function(e,t){var n,r,i,s,o,u=tinyMCE.activeEditor,a=tinymce.DOM;i=u.dom.getViewPort(u.getWin()),n=a.getPos(u.getContentAreaContainer()),r=u.dom.getPos(e),s=Math.max(r.x-i.x,0)+n.x,o=Math.max(r.y-i.y,0)+n.y,a.setStyles(t,{top:o+5+"px",left:s+5+"px",display:"block"})},_hideButtons:function(){var e=tinymce.DOM;e.hide(e.select("#wp_editbtns, #wp_gallerybtns"))},_resizeIframe:function(t,n,r){var i=t.getContentAreaContainer().firstChild;e.setStyle(i,"height",i.clientHeight+r),t.theme.deltaHeight+=r},_handleMoreBreak:function(e,t){var n,r;n='<img src="'+t+'/img/trans.gif" alt="$1" class="mce-wp-more mceItemNoResize" title="'+e.getLang("wordpress.wp_more_alt")+'" />',r='<img src="'+t+'/img/trans.gif" class="mce-wp-nextpage mceItemNoResize" title="'+e.getLang("wordpress.wp_page_alt")+'" />',e.onPostRender.add(function(){e.theme.onResolveName&&e.theme.onResolveName.add(function(t,n){"IMG"==n.node.nodeName&&(e.dom.hasClass(n.node,"mce-wp-more")&&(n.name="wpmore"),e.dom.hasClass(n.node,"mce-wp-nextpage")&&(n.name="wppage"))})}),e.onBeforeSetContent.add(function(e,t){t.content&&(t.content=t.content.replace(/<!--more(.*?)-->/g,n),t.content=t.content.replace(/<!--nextpage-->/g,r))}),e.onPostProcess.add(function(e,t){t.get&&(t.content=t.content.replace(/<img[^>]+>/g,function(e){if(-1!==e.indexOf('class="mce-wp-more')){var t,n=(t=e.match(/alt="(.*?)"/))?t[1]:"";e="<!--more"+n+"-->"}return-1!==e.indexOf('class="mce-wp-nextpage')&&(e="<!--nextpage-->"),e}))}),e.onNodeChange.add(function(e,t,n){t.setActive("wp_page","IMG"===n.nodeName&&e.dom.hasClass(n,"mce-wp-nextpage")),t.setActive("wp_more","IMG"===n.nodeName&&e.dom.hasClass(n,"mce-wp-more"))})}}),tinymce.PluginManager.add("wordpress",tinymce.plugins.WordPress)}();
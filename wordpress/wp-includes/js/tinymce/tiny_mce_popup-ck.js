/**
 * Popup.js
 *
 * Copyright, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */var tinymce,tinyMCE,tinyMCEPopup={init:function(){var e=this,t,n,r;t=e.getWin();tinymce=tinyMCE=t.tinymce;e.editor=tinymce.EditorManager.activeEditor;e.params=e.editor.windowManager.getParams();r=e.editor.windowManager.windows[e.editor.windowManager.windows.length-1];e.features=r.features;e.uiWindow=r;n=e.editor.settings;n.popup_css!==!1&&(n.popup_css?n.popup_css=e.editor.documentBaseURI.toAbsolute(n.popup_css):n.popup_css=e.editor.baseURI.toAbsolute("plugins/compat3x/css/dialog.css"));n.popup_css_add&&(n.popup_css+=","+e.editor.documentBaseURI.toAbsolute(n.popup_css_add));e.dom=e.editor.windowManager.createInstance("tinymce.dom.DOMUtils",document,{ownEvents:!0,proxy:tinyMCEPopup._eventProxy});e.dom.bind(window,"ready",e._onDOMLoaded,e);e.features.popup_css!==!1&&e.dom.loadCSS(e.features.popup_css||e.editor.settings.popup_css);e.listeners=[];e.onInit={add:function(t,n){e.listeners.push({func:t,scope:n})}};e.isWindow=!e.getWindowArg("mce_inline");e.id=e.getWindowArg("mce_window_id")},getWin:function(){return!window.frameElement&&window.dialogArguments||opener||parent||top},getWindowArg:function(e,t){var n=this.params[e];return tinymce.is(n)?n:t},getParam:function(e,t){return this.editor.getParam(e,t)},getLang:function(e,t){return this.editor.getLang(e,t)},execCommand:function(e,t,n,r){r=r||{};r.skip_focus=1;this.restoreSelection();return this.editor.execCommand(e,t,n,r)},resizeToInnerSize:function(){},executeOnLoad:function(evil){this.onInit.add(function(){eval(evil)})},storeSelection:function(){this.editor.windowManager.bookmark=tinyMCEPopup.editor.selection.getBookmark(1)},restoreSelection:function(){var e=tinyMCEPopup;!e.isWindow&&tinymce.isIE&&e.editor.selection.moveToBookmark(e.editor.windowManager.bookmark)},requireLangPack:function(){var e=this,t=e.getWindowArg("plugin_url")||e.getWindowArg("theme_url"),n=e.editor.settings,r;n.language!==!1&&(r=n.language||"en");if(t&&r&&e.features.translate_i18n!==!1&&n.language_load!==!1){t+="/langs/"+r+"_dlg.js";if(!tinymce.ScriptLoader.isDone(t)){document.write('<script type="text/javascript" src="'+t+'"></script>');tinymce.ScriptLoader.markDone(t)}}},pickColor:function(e,t){this.execCommand("mceColorPicker",!0,{color:document.getElementById(t).value,func:function(e){document.getElementById(t).value=e;try{document.getElementById(t).onchange()}catch(n){}}})},openBrowser:function(e,t){tinyMCEPopup.restoreSelection();this.editor.execCallback("file_browser_callback",e,document.getElementById(e).value,t,window)},confirm:function(e,t,n){this.editor.windowManager.confirm(e,t,n,window)},alert:function(e,t,n){this.editor.windowManager.alert(e,t,n,window)},close:function(){function t(){e.editor.windowManager.close(window);tinymce=tinyMCE=e.editor=e.params=e.dom=e.dom.doc=null}var e=this;tinymce.isOpera?e.getWin().setTimeout(t,0):t()},_restoreSelection:function(){var e=window.event.srcElement;e.nodeName=="INPUT"&&(e.type=="submit"||e.type=="button")&&tinyMCEPopup.restoreSelection()},_onDOMLoaded:function(){var e=tinyMCEPopup,t=document.title,n,r;if(e.features.translate_i18n!==!1){var i={update:"Ok",insert:"Ok",cancel:"Cancel",not_set:"--",class_name:"Class name",browse:"Browse"},s=tinymce.settings.language||"en";for(var o in i)tinymce.i18n.data[s+"."+o]=tinymce.i18n.translate(i[o]);n=document.body.innerHTML;tinymce.isIE&&(n=n.replace(/ (value|title|alt)=([^"][^\s>]+)/gi,' $1="$2"'));document.dir=e.editor.getParam("directionality","");(r=e.editor.translate(n))&&r!=n&&(document.body.innerHTML=r);(r=e.editor.translate(t))&&r!=t&&(document.title=t=r)}(!e.editor.getParam("browser_preferred_colors",!1)||!e.isWindow)&&e.dom.addClass(document.body,"forceColors");document.body.style.display="";if(tinymce.Env.ie)if(tinymce.Env.ie<11){document.attachEvent("onmouseup",tinyMCEPopup._restoreSelection);e.dom.add(e.dom.select("head")[0],"base",{target:"_self"})}else document.addEventListener("mouseup",tinyMCEPopup._restoreSelection,!1);e.restoreSelection();e.resizeToInnerSize();e.isWindow?window.focus():e.editor.windowManager.setTitle(window,t);!tinymce.isIE&&!e.isWindow&&e.dom.bind(document,"focus",function(){e.editor.windowManager.focus(e.id)});tinymce.each(e.dom.select("select"),function(e){e.onkeydown=tinyMCEPopup._accessHandler});tinymce.each(e.listeners,function(t){t.func.call(t.scope,e.editor)});if(e.getWindowArg("mce_auto_focus",!0)){window.focus();tinymce.each(document.forms,function(t){tinymce.each(t.elements,function(t){if(e.dom.hasClass(t,"mceFocus")&&!t.disabled){t.focus();return!1}})})}document.onkeyup=tinyMCEPopup._closeWinKeyHandler;"textContent"in document?e.uiWindow.getEl("head").firstChild.textContent=document.title:e.uiWindow.getEl("head").firstChild.innerText=document.title},_accessHandler:function(e){e=e||window.event;if(e.keyCode==13||e.keyCode==32){var t=e.target||e.srcElement;t.onchange&&t.onchange();return tinymce.dom.Event.cancel(e)}},_closeWinKeyHandler:function(e){e=e||window.event;e.keyCode==27&&tinyMCEPopup.close()},_eventProxy:function(e){return function(t){tinyMCEPopup.dom.events.callNativeHandler(e,t)}}};tinyMCEPopup.init();tinymce.util.Dispatcher=function(e){this.scope=e||this;this.listeners=[];this.add=function(e,t){this.listeners.push({cb:e,scope:t||this.scope});return e};this.addToTop=function(e,t){var n=this,r={cb:e,scope:t||n.scope};n.inDispatch?n.listeners=[r].concat(n.listeners):n.listeners.unshift(r);return e};this.remove=function(e){var t=this.listeners,n=null;tinymce.each(t,function(r,i){if(e==r.cb){n=r;t.splice(i,1);return!1}});return n};this.dispatch=function(){var e=this,t,n=arguments,r,i=e.listeners,s;e.inDispatch=!0;for(r=0;r<i.length;r++){s=i[r];t=s.cb.apply(s.scope,n.length>0?n:[s.scope]);if(t===!1)break}e.inDispatch=!1;return t}};
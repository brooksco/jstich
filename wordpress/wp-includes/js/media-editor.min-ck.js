!function(e,t){var n={};wp.media.coerce=function(e,n){return t.isUndefined(e[n])&&!t.isUndefined(this.defaults[n])?e[n]=this.defaults[n]:"true"===e[n]?e[n]=!0:"false"===e[n]&&(e[n]=!1),e[n]},wp.media.string={props:function(e,n){var r,i,s,o,u,a=wp.media.view.settings.defaultProps;return u=function(e){return"image"!==e.type||e.alt||(e.alt=e.caption||e.title||"",e.alt=e.alt.replace(/<\/?[^>]+>/g,""),e.alt=e.alt.replace(/[\r\n]+/g," ")),e},e=e?t.clone(e):{},n&&n.type&&(e.type=n.type),"image"===e.type&&(e=t.defaults(e||{},{align:a.align||getUserSetting("align","none"),size:a.size||getUserSetting("imgsize","medium"),url:"",classes:[]})),n?(e.title=e.title||n.title,r=e.link||a.link||getUserSetting("urlbutton","file"),"file"===r||"embed"===r?i=n.url:"post"===r?i=n.link:"custom"===r&&(i=e.linkUrl),e.linkUrl=i||"","image"===n.type?(e.classes.push("wp-image-"+n.id),o=n.sizes,s=o&&o[e.size]?o[e.size]:n,t.extend(e,t.pick(n,"align","caption","alt"),{width:s.width,height:s.height,src:s.url,captionId:"attachment_"+n.id})):"video"===n.type||"audio"===n.type?t.extend(e,t.pick(n,"title","type","icon","mime")):(e.title=e.title||n.filename,e.rel=e.rel||"attachment wp-att-"+n.id),u(e)):u(e)},link:function(e,t){var n;return e=wp.media.string.props(e,t),n={tag:"a",content:e.title,attrs:{href:e.linkUrl}},e.rel&&(n.attrs.rel=e.rel),wp.html.string(n)},audio:function(e,t){return wp.media.string._audioVideo("audio",e,t)},video:function(e,t){return wp.media.string._audioVideo("video",e,t)},_audioVideo:function(e,n,r){var i,s,o;return n=wp.media.string.props(n,r),"embed"!==n.link?wp.media.string.link(n):(i={},"video"===e&&(r.image&&-1===r.image.src.indexOf(r.icon)&&(i.poster=r.image.src),r.width&&(i.width=r.width),r.height&&(i.height=r.height)),o=r.filename.split(".").pop(),t.contains(wp.media.view.settings.embedExts,o)?(i[o]=r.url,s=wp.shortcode.string({tag:e,attrs:i})):wp.media.string.link(n))},image:function(e,n){var r,i,s,o,u={};return e=wp.media.string.props(e,n),i=e.classes||[],u.src=t.isUndefined(n)?e.url:n.url,t.extend(u,t.pick(e,"width","height","alt")),e.align&&!e.caption&&i.push("align"+e.align),e.size&&i.push("size-"+e.size),u["class"]=t.compact(i).join(" "),r={tag:"img",attrs:u,single:!0},e.linkUrl&&(r={tag:"a",attrs:{href:e.linkUrl},content:r}),o=wp.html.string(r),e.caption&&(s={},u.width&&(s.width=u.width),e.captionId&&(s.id=e.captionId),e.align&&(s.align="align"+e.align),o=wp.shortcode.string({tag:"caption",attrs:s,content:o+" "+e.caption})),o}},wp.media.collection=function(e){var n={};return t.extend(e,{coerce:wp.media.coerce,attachments:function(e){var r,i,s,o,u=e.string(),a=n[u],f=this;return delete n[u],a?a:(r=t.defaults(e.attrs.named,this.defaults),i=t.pick(r,"orderby","order"),i.type=this.type,i.perPage=-1,void 0!==r.orderby&&(r._orderByField=r.orderby),"rand"===r.orderby&&(r._orderbyRandom=!0),(!r.orderby||/^menu_order(?: ID)?$/i.test(r.orderby))&&(i.orderby="menuOrder"),r.ids?(i.post__in=r.ids.split(","),i.orderby="post__in"):r.include&&(i.post__in=r.include.split(",")),r.exclude&&(i.post__not_in=r.exclude.split(",")),i.post__in||(i.uploadedTo=r.id),o=t.omit(r,"id","ids","include","exclude","orderby","order"),t.each(this.defaults,function(e,t){o[t]=f.coerce(o,t)}),s=wp.media.query(i),s[this.tag]=new Backbone.Model(o),s)},shortcode:function(e){var r,i,s=e.props.toJSON(),o=t.pick(s,"orderby","order"),u=this;return e.type&&(o.type=e.type,delete e.type),e[this.tag]&&t.extend(o,e[this.tag].toJSON()),o.ids=e.pluck("id"),s.uploadedTo&&(o.id=s.uploadedTo),delete o.orderby,o._orderbyRandom?o.orderby="rand":o._orderByField&&"rand"!=o._orderByField&&(o.orderby=o._orderByField),delete o._orderbyRandom,delete o._orderByField,o.ids&&"post__in"===o.orderby&&delete o.orderby,t.each(this.defaults,function(e,t){o[t]=u.coerce(o,t),e===o[t]&&delete o[t]}),r=new wp.shortcode({tag:this.tag,attrs:o,type:"single"}),i=new wp.media.model.Attachments(e.models,{props:s}),i[this.tag]=e[this.tag],n[r.string()]=i,r},edit:function(e){var n,r,i,s=wp.shortcode.next(this.tag,e),o=this.defaults.id;if(s&&s.content===e)return s=s.shortcode,t.isUndefined(s.get("id"))&&!t.isUndefined(o)&&s.set("id",o),n=this.attachments(s),r=new wp.media.model.Selection(n.models,{props:n.props.toJSON(),multiple:!0}),r[this.tag]=n[this.tag],r.more().done(function(){r.props.set({query:!1}),r.unmirror(),r.props.unset("orderby")}),this.frame&&this.frame.dispose(),i=s.attrs.named.type&&"video"===s.attrs.named.type?"video-"+this.tag+"-edit":this.tag+"-edit",this.frame=wp.media({frame:"post",state:i,title:this.editTitle,editing:!0,multiple:!0,selection:r}).open(),this.frame}})},wp.media.gallery=new wp.media.collection({tag:"gallery",type:"image",editTitle:wp.media.view.l10n.editGalleryTitle,defaults:{itemtag:"dl",icontag:"dt",captiontag:"dd",columns:"3",link:"post",size:"thumbnail",order:"ASC",id:wp.media.view.settings.post&&wp.media.view.settings.post.id,orderby:"menu_order ID"}}),wp.media.featuredImage={get:function(){return wp.media.view.settings.post.featuredImageId},set:function(t){var n=wp.media.view.settings;n.post.featuredImageId=t,wp.media.post("set-post-thumbnail",{json:!0,post_id:n.post.id,thumbnail_id:n.post.featuredImageId,_wpnonce:n.post.nonce}).done(function(t){e(".inside","#postimagediv").html(t)})},frame:function(){return this._frame?this._frame:(this._frame=wp.media({state:"featured-image",states:[new wp.media.controller.FeaturedImage,new wp.media.controller.EditImage]}),this._frame.on("toolbar:create:featured-image",function(e){this.createSelectToolbar(e,{text:wp.media.view.l10n.setFeaturedImage})},this._frame),this._frame.on("content:render:edit-image",function(){var e=this.state("featured-image").get("selection"),t=(new wp.media.view.EditImage({model:e.single(),controller:this})).render();this.content.set(t),t.loadEditor()},this._frame),this._frame.state("featured-image").on("select",this.select),this._frame)},select:function(){var e=this.get("selection").single();wp.media.view.settings.post.featuredImageId&&wp.media.featuredImage.set(e?e.id:-1)},init:function(){e("#postimagediv").on("click","#set-post-thumbnail",function(e){e.preventDefault(),e.stopPropagation(),wp.media.featuredImage.frame().open()}).on("click","#remove-post-thumbnail",function(){wp.media.view.settings.post.featuredImageId=-1})}},e(wp.media.featuredImage.init),wp.media.editor={insert:function(e){var n,r=!t.isUndefined(window.tinymce),i=!t.isUndefined(window.QTags),s=window.wpActiveEditor;if(window.send_to_editor)return window.send_to_editor.apply(this,arguments);if(s)r&&(n=tinymce.get(s));else if(r&&tinymce.activeEditor)n=tinymce.activeEditor,s=window.wpActiveEditor=n.id;else if(!i)return!1;if(n&&!n.isHidden()?n.execCommand("mceInsertContent",!1,e):i?QTags.insertContent(e):document.getElementById(s).value+=e,window.tb_remove)try{window.tb_remove()}catch(o){}},add:function(r,i){var s=this.get(r);return s?s:(s=n[r]=wp.media(t.defaults(i||{},{frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0})),s.on("insert",function(n){var r=s.state();n=n||r.get("selection"),n&&e.when.apply(e,n.map(function(e){var t=r.display(e).toJSON();return this.send.attachment(t,e.toJSON())},this)).done(function(){wp.media.editor.insert(t.toArray(arguments).join("\n\n"))})},this),s.state("gallery-edit").on("update",function(e){this.insert(wp.media.gallery.shortcode(e).string())},this),s.state("playlist-edit").on("update",function(e){this.insert(wp.media.playlist.shortcode(e).string())},this),s.state("video-playlist-edit").on("update",function(e){this.insert(wp.media.playlist.shortcode(e).string())},this),s.state("embed").on("select",function(){var e=s.state(),n=e.get("type"),r=e.props.toJSON();r.url=r.url||"","link"===n?(t.defaults(r,{title:r.url,linkUrl:r.url}),this.send.link(r).done(function(e){wp.media.editor.insert(e)})):"image"===n&&(t.defaults(r,{title:r.url,linkUrl:"",align:"none",link:"none"}),"none"===r.link?r.linkUrl="":"file"===r.link&&(r.linkUrl=r.url),this.insert(wp.media.string.image(r)))},this),s.state("featured-image").on("select",wp.media.featuredImage.select),s.setState(s.options.state),s)},id:function(e){return e?e:(e=wpActiveEditor,e||t.isUndefined(window.tinymce)||!tinymce.activeEditor||(e=tinymce.activeEditor.id),e=e||"")},get:function(e){return e=this.id(e),n[e]},remove:function(e){e=this.id(e),delete n[e]},send:{attachment:function(e,n){var r,i,s=n.caption;return wp.media.view.settings.captions||delete n.caption,e=wp.media.string.props(e,n),r={id:n.id,post_content:n.description,post_excerpt:s},e.linkUrl&&(r.url=e.linkUrl),"image"===n.type?(i=wp.media.string.image(e),t.each({align:"align",size:"image-size",alt:"image_alt"},function(t,n){e[n]&&(r[t]=e[n])})):"video"===n.type?i=wp.media.string.video(e,n):"audio"===n.type?i=wp.media.string.audio(e,n):(i=wp.media.string.link(e),r.post_title=e.title),wp.media.post("send-attachment-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,attachment:r,html:i,post_id:wp.media.view.settings.post.id})},link:function(e){return wp.media.post("send-link-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,src:e.linkUrl,title:e.title,html:wp.media.string.link(e),post_id:wp.media.view.settings.post.id})}},open:function(e,t){var n;return t=t||{},e=this.id(e),n=this.get(e),(!n||n.options&&t.state!==n.options.state)&&(n=this.add(e,t)),n.open()},init:function(){e(document.body).on("click",".insert-media",function(t){var n=e(t.currentTarget),r=n.data("editor"),i={frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0};t.preventDefault(),n.blur(),n.hasClass("gallery")&&(i.state="gallery",i.title=wp.media.view.l10n.createGalleryTitle),wp.media.editor.open(r,i)}),(new wp.media.view.EditorUploader).render()}},t.bindAll(wp.media.editor,"open"),e(wp.media.editor.init)}(jQuery,_);